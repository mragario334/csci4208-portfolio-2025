<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zombie Survival - Parking Garage</title>
<link rel="stylesheet" href="styles/style.css">
</head>
<body>
<header>
  <h1>ðŸ§Ÿ Zombie Survival</h1>
  <button id="restart-btn" class="small-red-btn">Restart</button>
  <table class="inventory-table">
    <tr><th>Coins</th><th>Keys</th><th>Weapon Cards</th></tr>
    <tr>
      <td id="coins">0</td>
      <td id="keys">0</td>
      <td id="weaponCards">0</td>
    </tr>
  </table>
</header>

<main class="scene active">
  <div class="intro-box" id="scene-text">
    <h2>Parking Garage</h2>
    <p id="description"></p>
    <div class="choices" id="choices-container"></div>
  </div>
</main>

<script>
// Restart button
document.getElementById('restart-btn').onclick = function() {
  localStorage.clear();
  location.href = "index.html";
};

// Initialize storage if needed
if(!localStorage.getItem('coins')) localStorage.setItem('coins','0');
if(!localStorage.getItem('keys')) localStorage.setItem('keys','0');
if(!localStorage.getItem('weaponCards')) localStorage.setItem('weaponCards','0');
if(!localStorage.getItem('weaponCard')) localStorage.setItem('weaponCard','false');
if(!localStorage.getItem('stayedHome')) localStorage.setItem('stayedHome','false');

// Generate a random 4-digit code for pharmacy
function generatePharmacyCode(){
  const code = Math.floor(1000 + Math.random()*9000); // random 1000-9999
  localStorage.setItem('pharmacyCode', code.toString());
  console.log("Pharmacy Code:", code); // For debugging
  return code;
}

function updateInventoryDisplay() {
  document.getElementById('coins').textContent = localStorage.getItem('coins');
  document.getElementById('keys').textContent = localStorage.getItem('keys');
  document.getElementById('weaponCards').textContent = localStorage.getItem('weaponCards');
}

function useWeaponCard() {
  let current = parseInt(localStorage.getItem('weaponCards'));
  if(current > 0){
    localStorage.setItem('weaponCards', current-1);
    localStorage.setItem('weaponCard','false'); // mark as used
    updateInventoryDisplay();
    return true;
  }
  return false;
}

function addChoice(text, href) {
  const container=document.getElementById('choices-container');
  const a=document.createElement('a');
  a.href=href;
  a.className="button";
  a.textContent=text;
  container.appendChild(a);
}

function showDeathScreen(message){
  const container=document.getElementById('choices-container');
  const sceneText=document.getElementById('scene-text');
  sceneText.querySelector('#description').textContent = message;

  const deathMsg = document.createElement('h1');
  deathMsg.style.color="#f05c5c";
  deathMsg.style.marginTop="20px";
  deathMsg.textContent = "ðŸ’€ YOU DIED ðŸ’€";
  sceneText.appendChild(deathMsg);

  const restartBtn = document.createElement('a');
  restartBtn.href = "index.html";
  restartBtn.className = "button";
  restartBtn.textContent = "Restart Game";
  restartBtn.onclick = function(){ localStorage.clear(); };
  container.appendChild(restartBtn);
}

window.onload=function(){
  updateInventoryDisplay();
  const container=document.getElementById('choices-container');
  container.innerHTML="";
  const description=document.getElementById('description');

  // Generate new pharmacy code whenever player enters parking garage
  const code = generatePharmacyCode();

  const stayedHome = localStorage.getItem('stayedHome') === 'true';
  const hasWeaponCard = parseInt(localStorage.getItem('weaponCards')) > 0;

  if(stayedHome && hasWeaponCard){
    description.textContent = "You enter the dimly lit parking garage. A zombie from your house lunges at you! Luckily, a car tire blows and a lugnut shoots through the zombie's heart, killing it! Your weapon card is used up. A code has appeared on a screen nearby!";
    useWeaponCard();
    addChoice("Continue to the streets", "scene2.html");
    addChoice("Go to the Pharmacy", "scene7.html");
  } else if(stayedHome && !hasWeaponCard){
    showDeathScreen("You enter the parking garage. The zombie that was in your house catches up and rips your head off!");
  } else {
    description.textContent = "The parking garage is eerily quiet. You notice a code displayed on a security screen: " + code;
    addChoice("Return to the streets", "scene2.html");
    addChoice("Go to the Pharmacy", "scene7.html");
  }
};
</script>
</body>
</html>
