<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zombie Survival - House</title>
<link rel="stylesheet" href="styles/style.css">
</head>
<body>
<header>
  <h1>ðŸ§Ÿ Zombie Survival</h1>
  <button id="restart-btn" class="button">Restart Game</button>
  <table class="inventory-table">
    <tr><th>Coins</th><th>Keys</th><th>Weapon Cards</th></tr>
    <tr><td id="coins">0</td><td id="keys">0</td><td id="weaponCards">0</td></tr>
  </table>
</header>

<main class="scene active">
  <div class="intro-box">
    <h2>Your House</h2>
    <p id="scene-description">Loading scene...</p>
    <div class="choices" id="choices-container"></div>
  </div>
</main>

<script>
// Restart button
document.getElementById('restart-btn').onclick = function() {
  localStorage.clear();
  location.href = "index.html";
};

// Initialize game storage if not already set
if(!localStorage.getItem('newGameStarted')){
  localStorage.setItem('coins','0');
  localStorage.setItem('keys','0');
  localStorage.setItem('weaponCards','0');
  localStorage.setItem('stayedHome','false');
  localStorage.setItem('weaponCard','false');
  localStorage.setItem('gotWeaponCard','false');
  localStorage.setItem('gotCoin','false');
  localStorage.setItem('scene1Complete','false');
  localStorage.setItem('newGameStarted','true');
}

function updateInventoryDisplay() {
  document.getElementById('coins').textContent = localStorage.getItem('coins');
  document.getElementById('keys').textContent = localStorage.getItem('keys');
  document.getElementById('weaponCards').textContent = localStorage.getItem('weaponCards');
}

function gainItem(type, amount=1){
  let current = parseInt(localStorage.getItem(type));
  localStorage.setItem(type, current + amount);
  updateInventoryDisplay();
}

function addChoice(text, href, onclickFunc=null){
  const container = document.getElementById('choices-container');
  const a = document.createElement('a');
  a.href = href;
  a.className = 'button';
  a.textContent = text;
  if(onclickFunc) a.onclick = onclickFunc;
  container.appendChild(a);
}

window.onload = function(){
  updateInventoryDisplay();

  const stayedHome = localStorage.getItem('stayedHome') === 'true';
  const gotWeaponCard = localStorage.getItem('gotWeaponCard') === 'true';
  const gotCoin = localStorage.getItem('gotCoin') === 'true';
  const scene1Complete = localStorage.getItem('scene1Complete') === 'true';
  const container = document.getElementById('choices-container');
  const description = document.getElementById('scene-description');

  container.innerHTML = ""; // clear previous buttons

  if(scene1Complete){ 
    // Returning home
    description.textContent = "You return home. It's quiet now.";

    if(!gotWeaponCard){
      addChoice("Grab a weapon card", "scene2.html", function(){
        localStorage.setItem('weaponCard','true');
        gainItem('weaponCards',1);
        localStorage.setItem('gotWeaponCard','true');
      });
    }
    if(!gotCoin){
      addChoice("Search for supplies (+1 coin)", "scene2.html", function(){
        gainItem('coins',1);
        localStorage.setItem('gotCoin','true');
      });
    }

    // Always allow going back to streets
    addChoice("Return to the streets", "scene2.html");

  } else {
    // First time at home
    description.textContent = "The alarms blare. You hear screams. What do you do first?";

    if(!gotWeaponCard){
      addChoice("Grab a weapon card", "scene2.html", function(){
        localStorage.setItem('weaponCard','true');
        gainItem('weaponCards',1);
        localStorage.setItem('gotWeaponCard','true');
        localStorage.setItem('scene1Complete','true');
      });
    }

    if(!gotCoin){
      addChoice("Search for supplies (+1 coin)", "scene2.html", function(){
        gainItem('coins',1);
        localStorage.setItem('gotCoin','true');
        localStorage.setItem('scene1Complete','true');
      });
    }

    addChoice("Hide in your house", "scene1_room.html", function(){
      localStorage.setItem('stayedHome','true');
      localStorage.setItem('scene1Complete','true');
    });
  }
};
</script>
</body>
</html>
