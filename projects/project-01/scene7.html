<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zombie Survival - Pharmacy</title>
<link rel="stylesheet" href="styles/style.css">
</head>
<body>
<header>
  <h1>ðŸ§Ÿ Zombie Survival</h1>
  <button id="restart-btn" class="small-red-btn">Restart</button>
  <table class="inventory-table">
    <tr><th>Coins</th><th>Keys</th><th>Weapon Cards</th></tr>
    <tr>
      <td id="coins">0</td>
      <td id="keys">0</td>
      <td id="weaponCards">0</td>
    </tr>
  </table>
</header>

<main class="scene active">
  <div class="intro-box" id="scene-text">
    <h2>Pharmacy</h2>
    <p id="description">Loading scene...</p>
    <div id="timer" style="font-weight:bold; margin:10px 0;"></div>
    <input type="text" id="code-input" placeholder="Enter code" maxlength="4" style="display:none;">
    <div class="choices" id="choices-container"></div>
  </div>
</main>

<script>
// Restart button
document.getElementById('restart-btn').onclick = function() {
  localStorage.clear();
  location.href = "index.html";
};

// Initialize inventory if needed
if(!localStorage.getItem('coins')) localStorage.setItem('coins','0');
if(!localStorage.getItem('keys')) localStorage.setItem('keys','0');
if(!localStorage.getItem('weaponCards')) localStorage.setItem('weaponCards','0');
if(!localStorage.getItem('pharmacyLooted')) localStorage.setItem('pharmacyLooted','false');

function updateInventoryDisplay() {
  document.getElementById('coins').textContent = localStorage.getItem('coins');
  document.getElementById('keys').textContent = localStorage.getItem('keys');
  document.getElementById('weaponCards').textContent = localStorage.getItem('weaponCards');
}

function gainItem(type, amount=1){
  let current = parseInt(localStorage.getItem(type));
  localStorage.setItem(type, current + amount);
  updateInventoryDisplay();
}

function addChoice(text, href, onclickFunc=null){
  const container=document.getElementById('choices-container');
  const a=document.createElement('a');
  a.href=href;
  a.className="button";
  a.textContent=text;
  if(onclickFunc) a.onclick=onclickFunc;
  container.appendChild(a);
}

function showDeathScreen(message){
  const container=document.getElementById('choices-container');
  const sceneText=document.getElementById('scene-text');
  document.getElementById('description').textContent = message;

  const deathMsg = document.createElement('h1');
  deathMsg.style.color="#f05c5c";
  deathMsg.style.marginTop="20px";
  deathMsg.textContent = "ðŸ’€ YOU DIED ðŸ’€";
  sceneText.appendChild(deathMsg);

  const restartBtn = document.createElement('a');
  restartBtn.href = "index.html";
  restartBtn.className = "button";
  restartBtn.textContent = "Restart Game";
  restartBtn.onclick = function(){ localStorage.clear(); };
  container.appendChild(restartBtn);
}

window.onload = function() {
  updateInventoryDisplay();
  const container = document.getElementById('choices-container');
  container.innerHTML = "";
  const description = document.getElementById('description');
  const codeInput = document.getElementById('code-input');
  const timerDisplay = document.getElementById('timer');

  // If pharmacy already looted
  if(localStorage.getItem('pharmacyLooted') === 'true'){
    description.textContent = "The pharmacy is empty now. You can only leave.";
    addChoice("Return to the streets", "scene9.html");
    return;
  }

  // Pharmacy code logic
  let correctCode = localStorage.getItem('pharmacyCode');
  if(!correctCode) localStorage.setItem('pharmacyCode','1234'); // fallback
  correctCode = localStorage.getItem('pharmacyCode');

  description.textContent = "A zombie is chasing you! Quickly enter the code displayed at the parking garage to unlock the pharmacy door!";
  codeInput.style.display = "block";
  codeInput.focus();

  let timeLeft = 10; // 10-second countdown
  timerDisplay.textContent = `Time: ${timeLeft}`;

  const timerInterval = setInterval(() => {
    timeLeft--;
    timerDisplay.textContent = `Time: ${timeLeft}`;
    if(timeLeft <= 0){
      clearInterval(timerInterval);
      showDeathScreen("You ran out of time! The zombie caught you!");
      codeInput.disabled = true;
    }
  }, 1000);

  codeInput.addEventListener('input', function(){
    if(codeInput.value === correctCode){
      clearInterval(timerInterval);
      codeInput.disabled = true;
      codeInput.style.display = "none";
      timerDisplay.textContent = "";
      description.textContent = "You entered the correct code! The pharmacy door swings open. You are safe for now.";

      // Loot options - only one choice can be taken
      addChoice("Grab the weapon card (antidote)", "scene9.html", function(){
        gainItem("weaponCards",1);
        localStorage.setItem('pharmacyLooted','true');
        localStorage.setItem('pharmacyLoot','antidote'); 
      });

      addChoice("Search for coins", "scene9.html", function(){
        gainItem("coins",1);
        localStorage.setItem('pharmacyLooted','true');
        localStorage.setItem('pharmacyLoot','coin'); 
      });

      addChoice("Take the ladder", "scene9.html", function(){
        localStorage.setItem('pharmacyLooted','true');
        localStorage.setItem('pharmacyLoot','ladder'); 
      });
    }
  });
};
</script>
</body>
</html>
